<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title></title>
  <link href="/core.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.0.slim.min.js"
    integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
  <script src="/tummo.js" type="text/javascript"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Heebo&family=Nunito&family=Open+Sans&family=Roboto+Condensed:wght@300;400&display=swap"
    rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">  
  <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@wangeditor/editor@latest/dist/css/style.css" rel="stylesheet">
  <script src="https://unpkg.com/@wangeditor/editor@latest/dist/index.js"></script>
  <script src="/tummoCombobox.js"></script>
  <script src="/tummoCboCalendar.js"></script>
  <script src="/tummoTextbox.js"></script>
  <script src="/tummoWindow.js"></script>
  <script src="/tummoButton.js"></script>
  <script src="/tummoButtonUpload.js"></script>
  <script src="/tummoAlarmQuick.js"></script>
  <script src="/window.js" type="text/javascript"></script>
  <script src="/b4j_ws.js"></script>
  <link href="/core.css" rel="stylesheet">
  <link href="/tummoCombobox.css" rel="stylesheet">
  <link href="/tummoTextbox.css" rel="stylesheet">
  <link href="/tummo-icon.css" rel="stylesheet">
  <link href="/tummoButton.css" rel="stylesheet">
  <link href="/tummoWindow.css" rel="stylesheet">
  <link href="/tummoButton.css" rel="stylesheet">
  <link href="/tummoCboCalendar.css" rel="stylesheet">
  <link href="/tummoAlarmDialog.css" rel="stylesheet">
  <link rel="stylesheet" href="/tummoWindow.css">
  <link rel="stylesheet" href="/window.css">
  <link rel="stylesheet" href="/css/material-grid-legacy.min.css">
</head>

<body>
  <style>
    * {
      --width-btn: 120px;
    }

    body {
      font-family: 'Roboto Condensed';
      font-size: 14px;
    }
  </style>
  <section>
    <div id="layout" class="grid">
      <div class="unit half" style="display: grid;grid-template-columns: 70px 1fr;gap:5px;">
        <ul id="gr1" style="line-height: 25px;height: 25px;display: flex;flex-direction: column;align-content: center;gap:5px;list-style: none;">
            <li>Tiêu đề</li>
            <li>Miêu tả</li>
            <li>Thời gian</li>
        </ul>
        <ul id="gr2" style="display: grid;grid-template-columns: 1fr;gap:5px;list-style: none;">
          <li><div id="txttitle"></div></li>
          <li><div id="txtdes"></div></li>
          <div style="display: flex;gap:5px;height: 25px;">
          <li><div id="cbotungay"></div></li>
          <li><div id="btntkb"></div></li>
          </div>
        </ul>        
      </div>        
    <div class="unit half"  style="display: grid;grid-template-columns: 70px 1fr;gap:5px;">
        <ul id="gr3" style="line-height: 25px;height: 25px;display: flex;flex-direction: column;align-content: center;gap:5px;list-style: none;">
          <li>URL</li>
          <li>Chuyên mục</li>    
          <li>Tác giả</li>        
        </ul>
        <ul id="gr4" style="display: grid;grid-template-columns: 1fr;gap:5px;height: 90px;">
          <div id="txturl"></div>
          <div style="display: flex;gap:5px;height: 25px;">
            <div id="cbokieutrang"></div>
            <div id="cbochitiet"></div>
          </div>
          <div style="display: flex;gap:5px;height: 25px;">
            <div id="cbotacgia"></div>
            <div id="cbokeyword"></div>
          </div>
        </ul>
    </div>
  </div>  
    <div class="grid">
      <div class="unit whole">
        <div class="tummo-editor-wrapper">
          <div id="self-toolbar" class="tummo-editor-ctrl">
            <ul class="self-toolbar">
              <div id="btndangbai"></div>
      <div id="btnmedia"></div>
      <div id="btnupload"></div>
              </ul>
            </div>
        <div id="editor-toolbar" class="tummo-editor-ctrl" style="height: 40px;">
          
        </div>
        <div class="tummo-editor-body">
          <div id="editor-text-area">
    
          </div>
          <textarea id="hidencontent" style="display: none" name="content">
    
          </textarea>
        </div>

      </div>      
    </div>
  </div>
  </section>
  <div id="dialog" class="dialog" style="min-width:810px; min-height:630px;display: none;">
    <div class="titlebar t-window-header"><span class="t-window-title">Quản lý hình ảnh </span>
      <div class="t-window-close-bg" id="btnclose" name="close"><span class="t-window-close"></span></div>

      <!-- enter symbol here like &times; or &#x1f6c8; or use the default X if empty -->
    </div>
    <div class="t-window-body">
      <div class="content">
        <iframe id="frameurl" style="border: none;outline:none;" src="/uploadimage.html" width="100%" height="100%"></iframe>
      </div>
      <div class="buttonpane">
        <div class="buttonset">
          <button class="tummo-btn btn-yellow" name="ok">Chèn ảnh</button>
          <button class="tummo-btn btn-yellow" name="cancel">Thoát</button>
        </div>
      </div>
    </div>
    <div class="t-window-footer"></div>
  </div>

<!-- THOI KHOA BIEU -->
  <div id="dialogtkb" class="dialog" style="min-width:810px; min-height:630px;display: none;">
    <div class="titlebar t-window-header"><span class="t-window-title">Biên soạn thời khoá biểu</span>
      <div class="t-window-close-bg" id="btnclose" name="close"><span class="t-window-close"></span></div>
    </div>
    <div class="t-window-body">
      <div class="content">
        <iframe id="frameurl" style="border: none;outline:none;" src="/thoikhoabieu.html" width="100%" height="100%"></iframe>
      </div>
      <div class="buttonpane">
        <div class="buttonset">          
          <button class="tummo-btn btn-yellow" name="cancel">Thoát</button>
        </div>
      </div>
    </div>
    <div class="t-window-footer"></div>
  </div>
  <div id="alarm"></div>

  <script>
    var dialog;
    var dialogtkb;
var dialogalarm = $('#alarm').tummoAlarmQuick({ text: 'Dữ liệu đã được cập nhật hoàn thành!' });
    var _w = (document.getElementById("layout").offsetWidth / 2) - 100 ;

    var txttitle = $('#txttitle').tummoTextbox({ placeholder: 'Tiêu đề bài viết', type: 'text', width: _w, onLostFocus: f_title_lostfocus, labelWidth: 0 });
    var txturl = $('#txturl').tummoTextbox({ placeholder: 'Đường dẫn bài viết (Được tạo tự động)', type: 'text', width: _w, labelWidth: 0, onLostFocus: null });
    var txtDes = $('#txtdes').tummoTextbox({ placeholder: 'Miêu tả ngắn (Tốt cho SEO)', type: 'text', labelWidth: 0, fullWidth: true, width: _w });

    var _w2 = (_w / 2) - 55;

    var cbokieutrang = $('#cbokieutrang').tummoCombobox({ width: _w2, url: 'http://127.0.0.1/api/v3/?id=category', labelWidth: 0, onChange: cateCategory });
    var cbochitiet = $('#cbochitiet').tummoCombobox({ width: _w2, url: 'http://127.0.0.1/api/v3/?id=categorychild&filter=101', label: 'Chi tiết', labelWidth: 55 });
    var cbotacgia = $('#cbotacgia').tummoCombobox({ width: _w2, url: 'http://127.0.0.1/api/v3/?id=author', labelWidth: 0 });
    var cbokeyword = $('#cbokeyword').tummoCombobox({ width: _w2, url: 'http://127.0.0.1/api/v3/?id=keyword&filter=KEY-001', labelWidth: 55, label: 'Từ khoá', checkbox:true });
        
    var cbotungay = $('#cbotungay').tummoCboCalendar({ width: _w2, style: 'yellow', labelWidth: 0 });

    var btntkb = $('#btntkb').tummoButton({ text: 'Thiết lập thời khoá biểu', icon: '<img src="/icons/thoikhoabieu.svg">', style: 'yellow', click: f_opentkb });
    var btnpublish = $('#btndangbai').tummoButton({ text: 'Đăng bài', icon: '<img src="/icons/publish.svg">', style: 'yellow', click: f_publish });
    var btnmedia = $('#btnmedia').tummoButton({ text: 'Kho hình ảnh', icon: '<img src="/icons/insertimage.svg">', style: 'yellow', click: f_openmedia });
    var btnupload = $('#btnupload').tummoButtonUpload({ text: 'Upload', icon: '<img src="/icons/upload.svg">', style: 'yellow', click: f_uploaded });

    var htmltag = [{ id: 0, value: '<h1>', text: 'vd', default: false, checked: false }];

    var _wcbo = (_w / 2) - 27;

    function callbackDialog(btnName) {
      _showDialogButton.disabled = false;
      _showDialogButton.focus();
      if (btnName == 'close')
        _statusDialog.textContent = 'Dialog hidden...';
      else
        _statusDialog.textContent = btnName + ' button clicked...';
    }

    function f_publish() {

    }
    function f_opentkb() {
      dialogtkb.showDialog();
    }

    function cateCategory(id) {
      let url = 'http://127.0.0.1/api/v3/?id=categorychild&filter=' + id;
      cbochitiet.reload(url, null);
    }
    function f_title_lostfocus(id) {
      let text =  txttitle.getValue();
      b4j_raiseEvent('txttieude_changed',{title:text});
    }

    // ----------------------- EDITOR
// ----------------------- EDITOR
var editorbody = '';
    const E = window.wangEditor;
    const LANG = location.href.indexOf('lang=en') > 0 ? 'en' : 'en';
    E.i18nChangeLanguage(LANG);
    const $text1 = $('#hidencontent');
    window.editor = E.createEditor({
      selector: '#editor-text-area',
      html: '<p><br></p><p><br></p>',
      config: {
        placeholder: 'Type here...',
        height: 500,
        MENU_CONF: {
          uploadImage: {
            server: '/upload/v2/id=images',
            base64LimitSize: 10 * 1024 * 1024 // 10M 以下插入 base64
          }
        }
      }
    }
    )

    window.toolbar = E.createToolbar({
      editor,
      selector: '#editor-toolbar',
      config: {}
    });

    window.addEventListener("message", function (_data) {
      let result = _data.data[0];
      inserImageToEditor(result);

    });
    function inserTextToEditor(html) {
      if (editor.isDisabled()) editor.enable();
      if (!editor.isFocused()) editor.focus();

      editor.select([]);

      E.SlateTransforms.setNodes(editor, { type: 'paragraph' }, { mode: 'highest' });
      editor.setHtml(html);
    }


    function inserImageToEditor(image) {
      if (editor.isDisabled()) editor.enable();
      if (!editor.isFocused()) editor.focus();

      E.SlateTransforms.setNodes(editor, { type: 'paragraph' }, { mode: 'highest' });
      editor.dangerouslyInsertHtml('<img src="' + image + '"/>');
    }

    function f_openmedia() {
      dialog.showDialog();
    }

    function f_uploaded(event) {
      if (event == true) {
        dialogalarm.show('Tệp đã được tải thành công lên máy chủ!');
      }

    }

    $(document).ready(function () {
      b4j_connect('/ws/edit');
      
        var _showDialogButton = document.getElementById('show-dialog');
        var _statusDialog = document.getElementById('dialog-status');

        if (!dialog) {
          var id = 'dialog';
          // Instanciate the Dialog Box
          dialog = new DialogBox(id, callbackDialog);
          dialogtkb = new DialogBox('dialogtkb', callbackDialog);
        }
    });

  </script>



</body>

</html>